"use strict";

var __db__ = require('__driver/db'),
	__async__ = require('__driver/myasync').async,
	__notifications__ = require("__driver/notifications"),
	__cache__ = require("__driver/cache");

/*
	procesa el cierre de sesion, incluyendo las respectivas operaciones en base de datos
*/

module.exports = {
	exec: function (parms) {
		__db__.delete({
			collection : "user_session",
			condition : {
				_id : require('mongodb').ObjectID(parms.request.session.id_session_db)
			},
			callback : function(error, result){
				parms.request.session.destroy();
				parms.response.writeHead(301, {
					Location: "/"}
				);
				parms.response.end();
			}
		});
	}
}